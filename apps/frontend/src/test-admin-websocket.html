<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin WebSocket Test</title>
    <style>
        body {
            font-family: monospace;
            padding: 20px;
            background: #1e1e1e;
            color: #d4d4d4;
        }
        .controls {
            margin-bottom: 20px;
            display: flex;
            gap: 10px;
        }
        input {
            padding: 5px;
            width: 200px;
        }
        button {
            padding: 5px 15px;
            cursor: pointer;
        }
        .status {
            margin: 10px 0;
            padding: 10px;
            background: #2d2d30;
            border-radius: 4px;
        }
        .connected { color: #4ec9b0; }
        .disconnected { color: #f48771; }
        .messages {
            background: #2d2d30;
            padding: 10px;
            border-radius: 4px;
            height: 600px;
            overflow-y: auto;
        }
        .message {
            margin: 5px 0;
            padding: 10px;
            background: #1e1e1e;
            border-left: 3px solid #007acc;
            white-space: pre-wrap;
            word-wrap: break-word;
        }
        .message-header {
            color: #4ec9b0;
            margin-bottom: 5px;
        }
        .clear-btn {
            background: #f48771;
            color: white;
            border: none;
        }
    </style>
</head>
<body>
    <h1>Admin WebSocket Test</h1>

    <div class="controls">
        <input type="text" id="projectId" placeholder="Project ID" value="3">
        <button onclick="connect()">Connect as Admin</button>
        <button onclick="disconnect()">Disconnect</button>
        <button class="clear-btn" onclick="clearMessages()">Clear Messages</button>
    </div>

    <div class="status" id="status">
        <span class="disconnected">● Disconnected</span>
    </div>

    <div class="messages" id="messages"></div>

    <script>
        let ws = null;
        let messageCount = 0;

        function updateStatus(connected) {
            const status = document.getElementById('status');
            if (connected) {
                status.innerHTML = '<span class="connected">● Connected</span>';
            } else {
                status.innerHTML = '<span class="disconnected">● Disconnected</span>';
            }
        }

        function addMessage(type, data) {
            messageCount++;
            const messages = document.getElementById('messages');
            const messageDiv = document.createElement('div');
            messageDiv.className = 'message';

            const timestamp = new Date().toLocaleTimeString();
            const header = document.createElement('div');
            header.className = 'message-header';
            header.textContent = `[${timestamp}] Message #${messageCount} - Type: ${type}`;

            const content = document.createElement('div');
            content.textContent = JSON.stringify(data, null, 2);

            messageDiv.appendChild(header);
            messageDiv.appendChild(content);
            messages.insertBefore(messageDiv, messages.firstChild);
        }

        function connect() {
            if (ws) {
                console.log('Already connected');
                return;
            }

            const projectId = document.getElementById('projectId').value;
            if (!projectId) {
                alert('Please enter a project ID');
                return;
            }

            const wsUrl = `wss://user-websocket.ashish-91e.workers.dev/websocket?type=admin&projectId=${projectId}`;
            console.log('Connecting to:', wsUrl);

            ws = new WebSocket(wsUrl);

            ws.onopen = () => {
                console.log('Admin WebSocket connected');
                updateStatus(true);
                addMessage('CONNECTION', { status: 'Connected as admin', projectId: projectId });
            };

            ws.onclose = (event) => {
                console.log('Admin WebSocket disconnected', event);
                updateStatus(false);
                addMessage('CONNECTION', { status: 'Disconnected', code: event.code, reason: event.reason });
                ws = null;
            };

            ws.onerror = (error) => {
                console.error('Admin WebSocket error:', error);
                addMessage('ERROR', { error: 'WebSocket error occurred' });
            };

            ws.onmessage = (event) => {
                try {
                    const message = JSON.parse(event.data);
                    console.log('Admin received:', message);
                    addMessage(message.type || 'UNKNOWN', message);
                } catch (error) {
                    console.error('Failed to parse message:', error);
                    addMessage('RAW', event.data);
                }
            };
        }

        function disconnect() {
            if (ws) {
                ws.close();
                ws = null;
                updateStatus(false);
            }
        }

        function clearMessages() {
            document.getElementById('messages').innerHTML = '';
            messageCount = 0;
        }

        // Auto-connect on load for testing
        window.addEventListener('load', () => {
            // Uncomment to auto-connect:
            // setTimeout(connect, 1000);
        });
    </script>
</body>
</html>